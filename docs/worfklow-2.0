swagger: '2.0'
info:
  version: 1.0.0
  title: eGov Workflow Engine.
  description: |
    APIs for Workflow engine. This modules handles Below functionality. 
    1. Start workflow 
    2. Payment for Trade License
    3. Search existing trade application.
    4. Search existing trade license 
  contact:
    name: eGovernments Foundation
    email: contacts@egovernments.org
schemes:
  - https
basePath: /egov-wf
x-api-id: org.egov.wf.service
x-common-path: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-1-1.yml'
paths:
  /process/_transition:
    post:
      summary: Create new Trade Licenses.
      description: |
        To create new Trade License in the system. API supports bulk creation with max limit as defined in the Trade License Request. Please note that either whole batch succeeds or fails, there's no partial batch success. To create one Trade License, please pass array with one Trade License object. 
          

        Following Conditions are applied -
          1. PropertyId and OldPropertyId is not mandatory, If entered then validate. Invalid number fails trade license creation
          2. supportDocuments for a given Trade License will created. In case of not attaching the Mandatory Supported Documents creation of New Trade License Fails.
          3. LicenseNumber will be autogenerated on final approval for new License.
          4. ApplicationNumber will be autogenerated for new Trade License
      parameters:
        - name: ProcessInstanceRequest
          in: body
          description: Details for the new TradeLicense(s) + RequestInfo meta data.
          required: true
          schema:
            $ref: '#/definitions/ProcessIntanceRequest'
      responses:
        '201':
          description: ReponseInfo with Trade License(s) created successfully
          schema:
            $ref: '#/definitions/ProcessIntanceResponse'
        '400':
          description: TradeLicense(s) creation failed
          schema:
            $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/ErrorRes'
      tags:
        - WorkFlow
  /_search:
    post:
      summary: Get the list of Trade License defined in the system.
      description: 
        1. Search and get Trade License(s)  based on defined search criteria.

        2. In case multiple parameters are passed Trade License(s) will be searched as an AND combination of all the parameters.
      parameters:
        - $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-1-1.yml#/parameters/requestInfo'
        - $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-1-1.yml#/parameters/tenantId'
        - name: ids
          type: array
          items:
            type: integer
            format: int64
          in: query
          maxItems: 50
          description: unique identifier of trade licence 
        - name: businessService
          in: query
          description:  Unique application number for a trade license application.
          type: string
          minLength: 2
          maxLength: 64
        - name: businessIds
          type: array
          items:
            type: integer
            format: int64
          in: query
          maxItems: 50
          description: The list of businessIds
        - name: assignee
          in: query
          description: The unique  Old license number for a Trade license.
          type: string
          minLength: 2
          maxLength: 64
        - name: history
          in: query
          description: Boolean flag to return history of the workflow
          type: boolean
      responses:
        '200':
          description: Trade License(s) Retrived Successfully
          schema:
            $ref: '#/definitions/ProcessIntanceResponse'
        '400':
          description: Invalid input.
          schema:
            $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-1-1.yml#/definitions/ErrorRes'
      tags:
        - WorkFlow
  /businessservice/_create:
    post:
      summary: Create new BuinessService.
      description: |
        To create new Trade License in the system. API supports bulk creation with max limit as defined in the Trade License Request. Please note that either whole batch succeeds or fails, there's no partial batch success. To create one Trade License, please pass array with one Trade License object. 
          

        Following Conditions are applied -
          1. PropertyId and OldPropertyId is not mandatory, If entered then validate. Invalid number fails trade license creation
          2. supportDocuments for a given Trade License will created. In case of not attaching the Mandatory Supported Documents creation of New Trade License Fails.
          3. LicenseNumber will be autogenerated on final approval for new License.
          4. ApplicationNumber will be autogenerated for new Trade License
      parameters:
        - name: BusinessServiceRequest
          in: body
          description: Details for the new BusinessService(s) + RequestInfo meta data.
          required: true
          schema:
            $ref: '#/definitions/BusinessServiceRequest'
      responses:
        '201':
          description: ReponseInfo withBusinessService(s) created successfully
          schema:
            $ref: '#/definitions/BusinessServiceResponse'
        '400':
          description: BusinessService(s) creation failed
          schema:
            $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/ErrorRes'
      tags:
        - BusinessService
  /businessservice/_update:
    post:
      summary: Updates a existing BuinessService.
      description: |
        To create new Trade License in the system. API supports bulk creation with max limit as defined in the Trade License Request. Please note that either whole batch succeeds or fails, there's no partial batch success. To create one Trade License, please pass array with one Trade License object. 
          

        Following Conditions are applied -
          1. PropertyId and OldPropertyId is not mandatory, If entered then validate. Invalid number fails trade license creation
          2. supportDocuments for a given Trade License will created. In case of not attaching the Mandatory Supported Documents creation of New Trade License Fails.
          3. LicenseNumber will be autogenerated on final approval for new License.
          4. ApplicationNumber will be autogenerated for new Trade License
      parameters:
        - name: BusinessServiceRequest
          in: body
          description: Details for the new BusinessService(s) + RequestInfo meta data.
          required: true
          schema:
            $ref: '#/definitions/BusinessServiceRequest'
      responses:
        '201':
          description: ReponseInfo withBusinessService(s) created successfully
          schema:
            $ref: '#/definitions/BusinessServiceResponse'
        '400':
          description: BusinessService(s) creation failed
          schema:
            $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/ErrorRes'
      tags:
        - BusinessService
  /businessservice/_search:
    post:
      summary: Get the list of BusinessServices defined in the system.
      description: 
        1. Search and get BusinessServices(s)  based on defined search criteria.

        2. In case multiple parameters are passed BusinessService(s) will be searched as an AND combination of all the parameters.
      parameters:
        - $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-1-1.yml#/parameters/requestInfo'
        - $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-1-1.yml#/parameters/tenantId'
        - name: businessServices
          type: array
          items:
            type: integer
            format: int64
          in: query
          maxItems: 50
          description: BusinessService code of the businessService 
        - name: tenantId
          in: query
          description:  TenantId of the ULB.
          type: string
          minLength: 2
          maxLength: 64
      responses:
        '200':
          description: Trade License(s) Retrived Successfully
          schema:
            $ref: '#/definitions/BusinessServiceResponse'
        '400':
          description: Invalid input.
          schema:
            $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-1-1.yml#/definitions/ErrorRes'
      tags:
        - BusinessService

        
definitions:
  Document:
    type: object
    description: A Object holds the basic data for a Trade License
    properties:
      id:
        type: string
        description: State Unique Identifier uuid
        maxLength: 64
        minLength: 2
      tenantId:
        type: string
        description: Unique Identifier of ULB
        maxLength: 128
        minLength: 2
      documentType:
        type: string
        minLength: 2
        maxLength: 64
        description: '1.Unique document type code from common master. 2. This is defined under mdms common master. 3. Object defination is defined under ''https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-1-1.yml#/definitions/DocumentType'''
      fileStoreId:
        type: string
        minLength: 2
        maxLength: 64
        description: Unique file store id of uploaded document.
      documentUid:
        type: string
        minLength: 2
        maxLength: 64
        description: 'document number(eg.Pan number, aadhar number).'
      auditDetails:
        $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/AuditDetails'
    required:
      - tenantId
      - documentType
      - fileStoreId
  
  ProcessInstance:
    type: object
    description: A Object holds the basic data for a Trade License
    properties:
      id:
        type: string
        minLength: 2
        maxLength: 64
        description: Unique process instance id (UUID)
        readOnly: true
      tenantId:
        type: string
        description: Unique Identifier of ULB
        maxLength: 128
        minLength: 2
      businessService:
        type: string
        description: Business service key.
        maxLength: 256
        minLength: 2
      businessId:
        type: string
        description: | 
         Business id is a unique identifier of a task. eg(Propertyid, 
         TLid, ServiceRequestid) 
        maxLength: 64
        minLength: 2
      action:
        type: string
        description: Actions are define for each business service.
        maxLength: 64
        minLength: 2
      state:
        type: string
        description: Status will be populate by efengine for each action,
         if it is configured. 
        maxLength: 64
        minLength: 2
        readOnly: true
      comment:
        type: string
        description: consumer can pass the comment on each action.
        maxLength: 64
        minLength: 2
      documents:
        type: array
        description: Documents can be attached with each of the action.
        items:
          $ref: '#/definitions/Document'
      assigner:
        type: object
        $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/egov-user/contracts/v1-0-0.yml#/definitions/User'
        readOnly: true
      assignes:
        type: array
        items:
         $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/egov-user/contracts/v1-0-0.yml#/definitions/User'
      nextActions:
        type: array
        description: Wf will return next possible action based on .
        items:
          type: string
        readOnly: true
      sla:
        type: integer
        format: int64
        description: Date from when license is valid as epoch.
      currentStatus:
        type: string
        description: Status after action performed
      previousStatus:
        type: string
        description: Status before action performed
      entity:
        type: object
      auditDetails:
        $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/AuditDetails'
    required:
      - businessService
      - action
      - businessId
      - tenantId
      
  BusinessService:
    type: object
    description: A Object holds the 
    properties:
      tenantId:
        type: string
        description: Unique Identifier of ULB
        maxLength: 128
        minLength: 2
      uuid:
        type: string
        description: Unique Identifier uuid
        maxLength: 64
        minLength: 2
      businessService:
        type: string
        minLength: 2
        maxLength: 64
        description: Unique Identifier of the Trade License (UUID)
      getUri:
        type: string
        description: Unique License Number of the Trade. This is  unique in system for a tenant. This is mandatory but always be generated on the final approval. In Case of Legacy License User will enter the Old License Number.
        maxLength: 32
        minLength: 2
      postUri:
        type: string
        description: Unique License Number of the Trade. This is  unique in system for a tenant. This is mandatory but always be generated on the final approval. In Case of Legacy License User will enter the Old License Number.
        maxLength: 32
        minLength: 2
      states:
        type: array
        items:
          $ref: '#/definitions/State'
      auditDetails:
        $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/AuditDetails'
    required:
      - tenantId
      - businessService
      - url
  
  State:
    type: object
    description: A Object holds the basic data for a Trade License
    properties:
      uuid:
        type: string
        description: State Unique Identifier uuid
        maxLength: 64
        minLength: 2
      tenantId:
        type: string
        description: Unique Identifier of ULB
        maxLength: 128
        minLength: 2
      businessServiceId:
        type: string
        minLength: 2
        maxLength: 64
        description: Unique Identifier of the Trade License (UUID)
      state:
        type: string
        description: Unique License Number of the Trade. This is  unique in system for a tenant. This is mandatory but always be generated on the final approval. In Case of Legacy License User will enter the Old License Number.
        maxLength: 32
        minLength: 2
      applicationStatus:
        type: string
        description: Application status as in module
      docUploadRequired:
        type: boolean
        description: Boolean to describe if documents are mandatory 
      isStartState:
        type: boolean
        description: Boolean to describe if the workflow can be started from this state
      isTerminateState:
        type: boolean
        description: Boolean to describe if the state is the last state of workflow
      actions:
        type: array
        items:
          $ref: '#/definitions/Action'
      auditDetails:
        $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/AuditDetails'
  
  Action:
    type: object
    description: A Object holds the basic data for a Trade License
    properties:
      uuid:
        type: string
        description: State Unique Identifier uuid
        maxLength: 64
        minLength: 2
      tenantId:
        type: string
        description: TenantId of the ULB
        maxLength: 128
        minLength: 2
      stateId:
        type: string
        minLength: 2
        maxLength: 64
        description: The uuid of the state on which action is to performed
      action:
        type: string
        description: The action to be performed
      nextStateId:
        type: string
        minLength: 2
        maxLength: 64
        description: The uuid of the resultant state
      roles:
        description: Used for search result and create only
        type: array
        minimum: 1
        maximum: 20
        items:
          type: string
      auditDetails:
        $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/AuditDetails'
        
  ProcessIntanceRequest:
    description: 'Contract class to receive request. Array of TradeLicense items are used in case of create, whereas single TradeLicense item is used for update'
    properties:
      RequestInfo:
        $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-1-1.yml#/definitions/RequestInfo'
      ProcessInstances:
        description: Used for search result and create only
        type: array
        minimum: 1
        maximum: 100
        items:
          $ref: '#/definitions/ProcessInstance'
          
  ProcessIntanceResponse:
    description: 'Contract class to send response. Array of TradeLicense items are used in case of search results or response for create, whereas single TradeLicense item is used for update'
    properties:
      ResponseInfo:
        $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/ResponseInfo'
      ProcessInstances:
        description: Used for search result and create only
        type: array
        maximum: 500
        items:
          $ref: '#/definitions/ProcessInstance'

  BusinessServiceRequest:
    description: 'Contract class to receive request. Array of TradeLicense items are used in case of create, whereas single TradeLicense item is used for update'
    properties:
      RequestInfo:
        $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-1-1.yml#/definitions/RequestInfo'
      BusinessService:
        description: Used for search result and create only
        type: array
        minimum: 1
        maximum: 100
        items:
          $ref: '#/definitions/BusinessService'
          
  BusinessServiceResponse:
    description: 'Contract class to send response. Array of TradeLicense items are used in case of search results or response for create, whereas single TradeLicense item is used for update'
    properties:
      ResponseInfo:
        $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/ResponseInfo'
      BusinessService:
        description: Used for search result and create only
        type: array
        maximum: 500
        items:
          $ref: '#/definitions/BusinessService'          
